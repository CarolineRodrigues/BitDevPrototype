{"version":3,"sources":["preview-assets.route.ts"],"names":["PreviewAssetsRoute","constructor","preview","logger","req","res","component","status","jsonp","error","result","getPreviewFiles","json","e","send"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAKO,MAAMA,kBAAN,CAA0C;AAC/CC,EAAAA,WAAW;AACT;AACJ;AACA;AACYC,EAAAA,OAJC,EAKDC,MALC,EAMT;AAAA,SAFQD,OAER,GAFQA,OAER;AAAA,SADQC,MACR,GADQA,MACR;AAAA,mDAEM,iBAFN;AAAA,oDAGO,KAHP;AAAA,yDAKY,CACZ,OAAOC,GAAP,EAAqBC,GAArB,KAAuC;AACrC,UAAI;AACF;AACA,cAAMC,SAAS,GAAGF,GAAG,CAACE,SAAtB,CAFE,CAGF;;AACA,YAAI,CAACA,SAAL,EAAgB,OAAOD,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsB;AAAEC,UAAAA,KAAK,EAAE;AAAT,SAAtB,CAAP;AAChB,cAAMC,MAAM,GAAG,MAAM,KAAKR,OAAL,CAAaS,eAAb,CAA6BL,SAA7B,CAArB;AACA,YAAI,CAACI,MAAL,EAAa,OAAOL,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsB;AAAEC,UAAAA,KAAK,EAAE;AAAT,SAAtB,CAAP;AACb,eAAOJ,GAAG,CAACO,IAAJ,CAASF,MAAT,CAAP;AACD,OARD,CAQE,OAAOG,CAAP,EAAe;AACf,aAAKV,MAAL,CAAYM,KAAZ,CAAkB,+BAAlB,EAAmDI,CAAnD;AACA,eAAOR,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB,yCAArB,CAAP;AACD;AACF,KAdW,CALZ;AAAE;;AAP2C","sourcesContent":["import type { Request, Response, Route } from '@teambit/express';\nimport type { Component } from '@teambit/component';\nimport { serverError } from '@teambit/ui-foundation.ui.pages.static-error';\nimport type { Logger } from '@teambit/logger';\n\nimport { PreviewMain } from './preview.main.runtime';\n\nexport class PreviewAssetsRoute implements Route {\n  constructor(\n    /**\n     * preview extension.\n     */\n    private preview: PreviewMain,\n    private logger: Logger\n  ) {}\n\n  route = '/preview-assets';\n  method = 'get';\n\n  middlewares = [\n    async (req: Request, res: Response) => {\n      try {\n        // @ts-ignore TODO: @guy please fix.\n        const component = req.component as Component | undefined;\n        // if (!component) return res.status(404).send(noPreview());\n        if (!component) return res.status(404).jsonp({ error: 'not found' });\n        const result = await this.preview.getPreviewFiles(component);\n        if (!result) return res.status(404).jsonp({ error: 'not found' });\n        return res.json(result);\n      } catch (e: any) {\n        this.logger.error('failed getting preview assets', e);\n        return res.status(500).send(serverError());\n      }\n    },\n  ];\n}\n"]}