{"version":3,"sources":["node-endpoint.ts"],"names":["nodeEndpoint","nep","listeners","WeakMap","postMessage","bind","addEventListener","_","eh","l","data","handleEvent","on","set","removeEventListener","get","off","delete","start"],"mappings":";;;;;;;;;AAAA,SAASA,YAAT,CAAsBC,GAAtB,EAA2B;AACzB,QAAMC,SAAS,GAAG,IAAIC,OAAJ,EAAlB;AACA,SAAO;AACLC,IAAAA,WAAW,EAAEH,GAAG,CAACG,WAAJ,CAAgBC,IAAhB,CAAqBJ,GAArB,CADR;AAELK,IAAAA,gBAAgB,EAAE,CAACC,CAAD,EAAIC,EAAJ,KAAW;AAC3B,YAAMC,CAAC,GAAIC,IAAD,IAAU;AAClB,YAAI,iBAAiBF,EAArB,EAAyB;AACvBA,UAAAA,EAAE,CAACG,WAAH,CAAe;AAAED,YAAAA;AAAF,WAAf;AACD,SAFD,MAEO;AACLF,UAAAA,EAAE,CAAC;AAAEE,YAAAA;AAAF,WAAD,CAAF;AACD;AACF,OAND;;AAOAT,MAAAA,GAAG,CAACW,EAAJ,CAAO,SAAP,EAAkBH,CAAlB;AACAP,MAAAA,SAAS,CAACW,GAAV,CAAcL,EAAd,EAAkBC,CAAlB;AACD,KAZI;AAaLK,IAAAA,mBAAmB,EAAE,CAACP,CAAD,EAAIC,EAAJ,KAAW;AAC9B,YAAMC,CAAC,GAAGP,SAAS,CAACa,GAAV,CAAcP,EAAd,CAAV;;AACA,UAAI,CAACC,CAAL,EAAQ;AACN;AACD;;AACDR,MAAAA,GAAG,CAACe,GAAJ,CAAQ,SAAR,EAAmBP,CAAnB;AACAP,MAAAA,SAAS,CAACe,MAAV,CAAiBT,EAAjB;AACD,KApBI;AAqBLU,IAAAA,KAAK,EAAEjB,GAAG,CAACiB,KAAJ,IAAajB,GAAG,CAACiB,KAAJ,CAAUb,IAAV,CAAeJ,GAAf;AArBf,GAAP;AAuBD;;eAEcD,Y","sourcesContent":["function nodeEndpoint(nep) {\n  const listeners = new WeakMap();\n  return {\n    postMessage: nep.postMessage.bind(nep),\n    addEventListener: (_, eh) => {\n      const l = (data) => {\n        if ('handleEvent' in eh) {\n          eh.handleEvent({ data });\n        } else {\n          eh({ data });\n        }\n      };\n      nep.on('message', l);\n      listeners.set(eh, l);\n    },\n    removeEventListener: (_, eh) => {\n      const l = listeners.get(eh);\n      if (!l) {\n        return;\n      }\n      nep.off('message', l);\n      listeners.delete(eh);\n    },\n    start: nep.start && nep.start.bind(nep),\n  };\n}\n\nexport default nodeEndpoint;\n"]}