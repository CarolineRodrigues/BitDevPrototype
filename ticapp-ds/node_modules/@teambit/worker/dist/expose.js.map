{"version":3,"sources":["expose.ts"],"names":["setFunctionHandlers","transferHandlers","set","canHandle","obj","proxyMarker","serialize","port1","port2","MessageChannel","deserialize","port","start","expose","object","parentPort"],"mappings":";;;;;;;;;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAHA;AAKO,SAASA,mBAAT,GAA+B;AACpC;AACAC,8BAAiBC,GAAjB,CAAqB,OAArB,EAA8B;AAC5BC,IAAAA,SAAS,EAAGC,GAAD,IAASA,GAAG,IAAIA,GAAG,CAACC,sBAAD,CADF;AAE5BC,IAAAA,SAAS,EAAGF,GAAD,IAAS;AAClB,YAAM;AAAEG,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAmB,KAAIC,gCAAJ,GAAzB;AACA,6BAAcL,GAAd,EAAmB,6BAAaG,KAAb,CAAnB;AACA,aAAO,CAACC,KAAD,EAAQ,CAACA,KAAD,CAAR,CAAP;AACD,KAN2B;AAO5BE,IAAAA,WAAW,EAAGC,IAAD,IAAe;AAC1BA,MAAAA,IAAI,GAAG,6BAAaA,IAAb,CAAP;AACAA,MAAAA,IAAI,CAACC,KAAL;AACA,aAAO,qBAAKD,IAAL,CAAP;AACD;AAX2B,GAA9B;AAaD;;AAEDX,mBAAmB;;AAEZ,SAASa,MAAT,CAAgBC,MAAhB,EAA6B;AAClC,SAAO,uBAAcA,MAAd,EAAsB,6BAAaC,4BAAb,CAAtB,CAAP;AACD","sourcesContent":["// eslint-disable-next-line import/no-unresolved\nimport { parentPort, MessageChannel } from 'worker_threads';\nimport { expose as comlinkExpose, proxyMarker, wrap, transferHandlers } from 'comlink';\nimport nodeEndpoint from './node-endpoint';\n\nexport function setFunctionHandlers() {\n  // Override comlink's default proxy handler to use Node endpoints\n  transferHandlers.set('proxy', {\n    canHandle: (obj) => obj && obj[proxyMarker],\n    serialize: (obj) => {\n      const { port1, port2 } = new MessageChannel();\n      comlinkExpose(obj, nodeEndpoint(port1));\n      return [port2, [port2]];\n    },\n    deserialize: (port: any) => {\n      port = nodeEndpoint(port);\n      port.start();\n      return wrap(port);\n    },\n  } as any);\n}\n\nsetFunctionHandlers();\n\nexport function expose(object: any) {\n  return comlinkExpose(object, nodeEndpoint(parentPort));\n}\n"]}