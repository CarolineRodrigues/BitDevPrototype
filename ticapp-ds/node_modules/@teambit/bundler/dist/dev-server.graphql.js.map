{"version":3,"sources":["dev-server.graphql.ts"],"names":["devServerSchema","bundler","typeDefs","resolvers","Component","server","component","args","context","requestedId","body","variables","id","includes","componentServer","getComponentServer","env","envRuntime","url"],"mappings":";;;;;;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAIA;AACO,SAASA,eAAT,CAAyBC,OAAzB,EAAuD;AAC5D,SAAO;AACLC,IAAAA,QAAQ,EAAE,kBAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAVS;AAWLC,IAAAA,SAAS,EAAE;AACTC,MAAAA,SAAS,EAAE;AACTC,QAAAA,MAAM,EAAE,CAACC,SAAD,EAAuBC,IAAvB,EAA6BC,OAA7B,KAAyC;AAC/C;AACA;AACA;AACA,gBAAMC,WAAW,GAAGD,OAAO,CAACE,IAAR,CAAaC,SAAb,CAAuBC,EAA3C,CAJ+C,CAK/C;AACA;AACA;;AACA,cAAIH,WAAW,IAAIA,WAAW,CAACI,QAAZ,CAAqB,GAArB,CAAnB,EAA8C;AAC5C,mBAAO,EAAP;AACD;;AACD,gBAAMC,eAAe,GAAGb,OAAO,CAACc,kBAAR,CAA2BT,SAA3B,CAAxB;AACA,cAAI,CAACQ,eAAL,EAAsB,OAAO,EAAP;AAEtB,iBAAO;AACLE,YAAAA,GAAG,EAAEF,eAAe,CAACN,OAAhB,CAAwBS,UAAxB,CAAmCL,EADnC;AAELM,YAAAA,GAAG,EAAEJ,eAAe,CAACI;AAFhB,WAAP;AAID;AAnBQ;AADF;AAXN,GAAP;AAmCD","sourcesContent":["import { Component } from '@teambit/component';\nimport { Schema } from '@teambit/graphql';\nimport { gql } from '@apollo/client';\n\nimport { BundlerMain } from './bundler.main.runtime';\n\n// TODO: this has to be refactored to the Preview aspect. with the entire preview logic here.\nexport function devServerSchema(bundler: BundlerMain): Schema {\n  return {\n    typeDefs: gql`\n      extend type Component {\n        server: ComponentServer\n      }\n\n      type ComponentServer {\n        env: String\n        url: String\n      }\n    `,\n    resolvers: {\n      Component: {\n        server: (component: Component, args, context) => {\n          // This is a bit of a hack to get the requested id. it assumes the variable name of\n          // the gotHost.get query is \"id\".\n          // see it in scopes/component/component/component.graphql.ts\n          const requestedId = context.body.variables.id;\n          // if we ask for specific id with specific version it means we want to fetch if from scope\n          // so don't return the server url\n          // see https://github.com/teambit/bit/issues/5328\n          if (requestedId && requestedId.includes('@')) {\n            return {};\n          }\n          const componentServer = bundler.getComponentServer(component);\n          if (!componentServer) return {};\n\n          return {\n            env: componentServer.context.envRuntime.id,\n            url: componentServer.url,\n          };\n        },\n      },\n    },\n  };\n}\n"]}