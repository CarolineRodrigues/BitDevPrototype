{"version":3,"sources":["webpack.browser.config.ts"],"names":["createWebpackConfig","workspaceDir","entryFiles","title","publicDir","baseConfig","browserConfig","createBrowserConfig","combined","output","path","resolve","publicPath","optimization","minimize","minimizer","TerserPlugin","terserOptions","parse","ecma","compress","warnings","comparisons","inline","mangle","safari10","comments","ascii_only","CssMinimizerPlugin","minimizerOptions","preset","minifyFontValues","removeQuotes","splitChunks","chunks","name","runtimeChunk","entrypoint","plugins","HtmlWebpackPlugin","inject","templateContent","minify","removeComments","collapseWhitespace","removeRedundantAttributes","useShortDoctype","removeEmptyAttributes","removeStyleLinkTypeAttributes","keepClosingSlash","minifyJS","minifyCSS","minifyURLs"],"mappings":"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","sourcesContent":["import { Configuration } from 'webpack';\nimport TerserPlugin from 'terser-webpack-plugin';\nimport CssMinimizerPlugin from 'css-minimizer-webpack-plugin';\nimport path from 'path';\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\nimport { merge } from 'webpack-merge';\n\nimport { html } from './html';\nimport createBaseConfig from './webpack.base.config';\n\nexport default function createWebpackConfig(\n  workspaceDir: string,\n  entryFiles: string[],\n  title: string,\n  publicDir: string\n): Configuration {\n  const baseConfig = createBaseConfig(workspaceDir, entryFiles);\n  const browserConfig = createBrowserConfig(workspaceDir, title, publicDir);\n\n  const combined = merge(baseConfig, browserConfig);\n\n  return combined;\n}\n\nfunction createBrowserConfig(workspaceDir: string, title: string, publicDir: string) {\n  const browserConfig: Configuration = {\n    // target: 'web', // already default\n\n    output: {\n      path: path.resolve(workspaceDir, publicDir),\n      // webpack uses `publicPath` to determine where the app is being served from.\n      // It requires a trailing slash, or the file assets will get an incorrect path.\n      // We inferred the \"public path\" (such as / or /my-project) from homepage.\n      publicPath: '/',\n    },\n\n    optimization: {\n      minimize: true,\n      minimizer: [\n        // This is only used in production mode\n        new TerserPlugin({\n          terserOptions: {\n            parse: {\n              // We want terser to parse ecma 8 code. However, we don't want it\n              // to apply any minification steps that turns valid ecma 5 code\n              // into invalid ecma 5 code. This is why the 'compress' and 'output'\n              // sections only apply transformations that are ecma 5 safe\n              // https://github.com/facebook/create-react-app/pull/4234\n              ecma: 8,\n            },\n            compress: {\n              ecma: 5,\n              warnings: false,\n              // Disabled because of an issue with Uglify breaking seemingly valid code:\n              // https://github.com/facebook/create-react-app/issues/2376\n              // Pending further investigation:\n              // https://github.com/mishoo/UglifyJS2/issues/2011\n              comparisons: false,\n              // Disabled because of an issue with Terser breaking valid code:\n              // https://github.com/facebook/create-react-app/issues/5250\n              // Pending further investigation:\n              // https://github.com/terser-js/terser/issues/120\n              inline: 2,\n            },\n            mangle: {\n              safari10: true,\n            },\n            output: {\n              ecma: 5,\n              comments: false,\n              // Turned on because emoji and regex is not minified properly using default\n              // https://github.com/facebook/create-react-app/issues/2488\n              ascii_only: true,\n            },\n          },\n        }),\n        new CssMinimizerPlugin({\n          minimizerOptions: {\n            preset: [\n              'default',\n              {\n                minifyFontValues: { removeQuotes: false },\n              },\n            ],\n          },\n        }),\n      ],\n      // Automatically split vendor and commons\n      // https://twitter.com/wSokra/status/969633336732905474\n      // https://medium.com/webpack/webpack-4-code-splitting-chunk-graph-and-the-splitchunks-optimization-be739a861366\n      splitChunks: {\n        chunks: 'all',\n        name: false,\n      },\n      // Keep the runtime chunk separated to enable long term caching\n      // https://twitter.com/wSokra/status/969679223278505985\n      // https://github.com/facebook/create-react-app/issues/5358\n      runtimeChunk: {\n        name: (entrypoint) => `runtime-${entrypoint.name}`,\n      },\n    },\n\n    plugins: [\n      new HtmlWebpackPlugin({\n        inject: true,\n        templateContent: html(title),\n\n        minify: {\n          removeComments: true,\n          collapseWhitespace: true,\n          removeRedundantAttributes: true,\n          useShortDoctype: true,\n          removeEmptyAttributes: true,\n          removeStyleLinkTypeAttributes: true,\n          keepClosingSlash: true,\n          minifyJS: true,\n          minifyCSS: true,\n          minifyURLs: true,\n        },\n      }),\n    ],\n  };\n\n  return browserConfig;\n}\n"]}