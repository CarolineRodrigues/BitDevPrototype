{"version":3,"sources":["pubsub-context.tsx"],"names":["pubsubRegistry","undefined","createProvider","pubSubContext","PubSubProvider","children","usePubSub","usePubSubIframe","ref","pubSub","current","destroyConnection","connect"],"mappings":";;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;AAUO,MAAMA,cAAc,gBAAG,4BAA0CC,SAA1C,CAAvB;;;AAEA,SAASC,cAAT,CAAwBC,aAAxB,EAAuD;AAC5D,QAAMC,cAAc,GAAG,CAAC;AAAEC,IAAAA;AAAF,GAAD,kBACrB,+BAAC,cAAD,CAAgB,QAAhB;AAAyB,IAAA,KAAK,EAAEF;AAAhC,KAAgDE,QAAhD,CADF;;AAIA,SAAOD,cAAP;AACD;;AAEM,SAASE,SAAT,GAAqB;AAC1B,SAAO,yBAAWN,cAAX,CAAP;AACD;;AAEM,SAASO,eAAT,CAAyBC,GAAzB,EAA6D;AAClE,QAAMC,MAAM,GAAGH,SAAS,EAAxB;AAEA,0BAAU,MAAM;AACd,QAAI,EAACE,GAAD,aAACA,GAAD,eAACA,GAAG,CAAEE,OAAN,KAAiB,CAACD,MAAtB,EAA8B,OAAO,MAAM,CAAE,CAAf;AAE9B,UAAME,iBAAiB,GAAGF,MAAM,CAACG,OAAP,CAAeJ,GAAG,CAACE,OAAnB,CAA1B;AACA,WAAO,MAAMC,iBAAiB,EAA9B;AACD,GALD,EAKG,CAACH,GAAD,aAACA,GAAD,uBAACA,GAAG,CAAEE,OAAN,EAAeD,MAAf,CALH;AAMD","sourcesContent":["import React, { createContext, useContext, useEffect, RefObject, ReactNode } from 'react';\n\nexport interface PubSubRegistry {\n  /**\n   * starts a connection to an iframe child.\n   * Returns a destroy() function that will break the connection.\n   */\n  connect(ref: HTMLIFrameElement): () => void;\n}\n\nexport const pubsubRegistry = createContext<PubSubRegistry | undefined>(undefined);\n\nexport function createProvider(pubSubContext: PubSubRegistry) {\n  const PubSubProvider = ({ children }: { children: ReactNode }) => (\n    <pubsubRegistry.Provider value={pubSubContext}>{children}</pubsubRegistry.Provider>\n  );\n\n  return PubSubProvider;\n}\n\nexport function usePubSub() {\n  return useContext(pubsubRegistry);\n}\n\nexport function usePubSubIframe(ref?: RefObject<HTMLIFrameElement>) {\n  const pubSub = usePubSub();\n\n  useEffect(() => {\n    if (!ref?.current || !pubSub) return () => {};\n\n    const destroyConnection = pubSub.connect(ref.current);\n    return () => destroyConnection();\n  }, [ref?.current, pubSub]);\n}\n"]}