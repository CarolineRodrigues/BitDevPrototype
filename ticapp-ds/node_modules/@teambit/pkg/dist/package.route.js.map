{"version":3,"sources":["package.route.ts"],"names":["routePath","PackageRoute","constructor","pkg","req","res","component","file","getPackageTarFile","status","jsonp","error","contents","contentType","mime","getType","set","basename","send"],"mappings":";;;;;;;;;;;;;;;;;;;;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAIO,MAAMA,SAAS,GAAI,SAAnB;;;AACA,MAAMC,YAAN,CAAoC;AACzCC,EAAAA,WAAW;AACT;AACJ;AACA;AACYC,EAAAA,GAJC,EAKT;AAAA,SADQA,GACR,GADQA,GACR;AAAA,mDAEO,IAAGH,SAAU,EAFpB;AAAA,oDAGO,KAHP;AAAA,yDAKY,CACZ,OAAOI,GAAP,EAAqBC,GAArB,KAAuC;AACrC;AACA,YAAMC,SAAc,GAAGF,GAAG,CAACE,SAA3B;AACA,YAAMC,IAAI,GAAG,MAAM,KAAKJ,GAAL,CAASK,iBAAT,CAA2BF,SAA3B,CAAnB,CAHqC,CAIrC;;AACA,UAAI,CAACC,IAAL,EAAW,OAAOF,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,KAAhB,CAAsB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAtB,CAAP;AACX,YAAMC,QAAQ,GAAGL,IAAI,CAACK,QAAtB;;AACA,YAAMC,WAAW,GAAGC,gBAAKC,OAAL,CAAa,MAAb,CAApB;;AACAV,MAAAA,GAAG,CAACW,GAAJ,CAAQ,qBAAR,EAAgC,wBAAuBT,IAAI,CAACU,QAAS,EAArE;AACA,UAAIJ,WAAJ,EAAiBR,GAAG,CAACW,GAAJ,CAAQ,cAAR,EAAwBH,WAAxB;AACjB,aAAOR,GAAG,CAACa,IAAJ,CAASN,QAAT,CAAP;AACD,KAZW,CALZ;AAAE;;AANqC","sourcesContent":["import { Request, Response, Route } from '@teambit/express';\nimport mime from 'mime';\n\nimport { PkgMain } from './pkg.main.runtime';\n\nexport const routePath = `package`;\nexport class PackageRoute implements Route {\n  constructor(\n    /**\n     * pkg extension.\n     */\n    private pkg: PkgMain\n  ) {}\n\n  route = `/${routePath}`;\n  method = 'get';\n\n  middlewares = [\n    async (req: Request, res: Response) => {\n      // @ts-ignore TODO: @guy please fix.\n      const component: any = req.component as any;\n      const file = await this.pkg.getPackageTarFile(component);\n      // TODO: 404 again how to handle.\n      if (!file) return res.status(404).jsonp({ error: 'not found' });\n      const contents = file.contents;\n      const contentType = mime.getType('.tgz');\n      res.set('Content-disposition', `attachment; filename=${file.basename}`);\n      if (contentType) res.set('Content-Type', contentType);\n      return res.send(contents);\n    },\n  ];\n}\n"]}