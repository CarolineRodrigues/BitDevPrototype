{"version":3,"sources":["workspace.ui.runtime.tsx"],"names":["WorkspaceUI","constructor","routeSlot","componentUi","menuSlot","menuItemSlot","sidebar","sidebarSlot","sidebarItemSlot","drawerWidgetSlot","drawerComponentsFiltersSlot","commandBarUI","reactRouterUI","menuItems","register","routes","components","componentSearcher","update","links","filters","widgets","category","title","keyChar","handler","run","ComponentSearcher","navigateTo","registerRoutes","registerDrawers","drawers","registerDrawer","registerSidebarWidget","componentTreeNode","uiRoot","addSearcher","treeWidgets","filtersSlot","setKeyBindHandler","addCommand","id","displayName","keybinding","path","children","provider","ui","componentTree","graphUI","config","registerTreeNode","ComponentTreeWidget","registerComponentWidget","widget","workspaceUI","registerDrawerComponentFilters","DeprecateFilter","EnvsFilter","registerDrawerWidgets","registerRoot","bind","registerMenuItem","registerSidebarLink","registerMenuRoutes","exact","routePath","getMenu","WorkspaceAspect","getComponentUI","UIAspect","ComponentAspect","SidebarAspect","ComponentTreeAspect","CommandBarAspect","ReactRouterAspect","GraphAspect","UIRuntime","Slot","withType","addRuntime"],"mappings":"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","sourcesContent":["import { ComponentAspect, ComponentUI, ComponentModel } from '@teambit/component';\nimport { ComponentTreeAspect, ComponentTreeUI, ComponentTreeNode } from '@teambit/component-tree';\nimport { Slot, SlotRegistry } from '@teambit/harmony';\nimport ReactRouterAspect, { ReactRouterUI } from '@teambit/react-router';\nimport { RouteSlot } from '@teambit/ui-foundation.ui.react-router.slot-router';\nimport { Menu } from '@teambit/ui-foundation.ui.menu';\nimport SidebarAspect, { SidebarUI, SidebarItem, SidebarItemSlot } from '@teambit/sidebar';\nimport { MenuItemSlot, MenuItem } from '@teambit/ui-foundation.ui.main-dropdown';\nimport { UIAspect, UIRootUI as UIRoot, UIRuntime, UiUI } from '@teambit/ui';\nimport { GraphAspect, GraphUI } from '@teambit/graph';\nimport React, { ReactNode } from 'react';\nimport { RouteProps } from 'react-router-dom';\nimport CommandBarAspect, { CommandBarUI, ComponentSearcher, CommandHandler } from '@teambit/command-bar';\nimport { MenuLinkItem } from '@teambit/design.ui.surfaces.menu.link-item';\nimport type { DrawerType } from '@teambit/ui-foundation.ui.tree.drawer';\nimport { ComponentFilters, DeprecateFilter, EnvsFilter } from '@teambit/component.ui.component-filters';\nimport {\n  DrawerWidgetSlot,\n  FilterWidget,\n  TreeToggleWidget,\n  ComponentFiltersSlot,\n} from '@teambit/component.ui.component-drawer';\nimport { ComponentTreeWidget } from './component-tree.widget';\nimport { Workspace } from './ui';\nimport { WorkspaceAspect } from './workspace.aspect';\nimport { workspaceDrawer } from './workspace.ui.drawer';\n\nexport type SidebarWidgetSlot = SlotRegistry<ComponentTreeNode>;\n\nexport class WorkspaceUI {\n  constructor(\n    /**\n     * route slot.\n     */\n    private routeSlot: RouteSlot,\n\n    /**\n     * component ui extension.\n     */\n    private componentUi: ComponentUI,\n\n    /**\n     * menu slot\n     */\n    private menuSlot: RouteSlot,\n\n    private menuItemSlot: MenuItemSlot,\n\n    private sidebar: SidebarUI,\n\n    private sidebarSlot: SidebarWidgetSlot,\n\n    /**\n     * sidebar link slot\n     */\n    private sidebarItemSlot: SidebarItemSlot,\n\n    private drawerWidgetSlot: DrawerWidgetSlot,\n\n    private drawerComponentsFiltersSlot: ComponentFiltersSlot,\n\n    private commandBarUI: CommandBarUI,\n\n    reactRouterUI: ReactRouterUI\n  ) {\n    this.componentSearcher = new ComponentSearcher(reactRouterUI.navigateTo);\n  }\n\n  private setKeyBindHandler: (updated: CommandHandler) => void = () => {};\n\n  /**\n   * register a route to the workspace.\n   */\n  registerRoutes(routes: RouteProps[]) {\n    this.routeSlot.register(routes);\n    return this;\n  }\n\n  registerDrawers(...drawers: DrawerType[]) {\n    this.sidebar.registerDrawer(...drawers);\n    return this;\n  }\n\n  registerSidebarWidget(componentTreeNode: ComponentTreeNode) {\n    this.sidebarSlot.register(componentTreeNode);\n    return this;\n  }\n\n  registerMenuItem = (menuItems: MenuItem[]) => {\n    this.menuItemSlot.register(menuItems);\n  };\n\n  registerMenuRoutes = (routes: RouteProps[]) => {\n    this.menuSlot.register(routes);\n    return this;\n  };\n\n  setComponents = (components: ComponentModel[]) => {\n    this.componentSearcher.update(components);\n  };\n\n  registerSidebarLink = (...links: SidebarItem[]) => {\n    this.sidebarItemSlot.register(links);\n  };\n\n  componentSearcher: ComponentSearcher;\n\n  /**\n   * register component filters\n   */\n  registerDrawerComponentFilters = (filters: ComponentFilters) => {\n    this.drawerComponentsFiltersSlot.register(filters);\n  };\n\n  registerDrawerWidgets = (widgets: ReactNode[]) => {\n    this.drawerWidgetSlot.register(widgets);\n  };\n\n  uiRoot(): UIRoot {\n    this.commandBarUI.addSearcher(this.componentSearcher);\n    this.registerDrawers(\n      workspaceDrawer({\n        treeWidgets: this.sidebarSlot,\n        drawerWidgetSlot: this.drawerWidgetSlot,\n        filtersSlot: this.drawerComponentsFiltersSlot,\n      })\n    );\n\n    const [setKeyBindHandler] = this.commandBarUI.addCommand({\n      id: 'sidebar.toggle', // TODO - extract to a component!\n      handler: () => {},\n      displayName: 'Toggle component list',\n      keybinding: 'alt+s',\n    });\n    this.setKeyBindHandler = setKeyBindHandler;\n\n    return {\n      routes: [\n        {\n          path: '/',\n          children: (\n            <Workspace\n              menuSlot={this.menuSlot}\n              routeSlot={this.routeSlot}\n              sidebar={<this.sidebar.render itemSlot={this.sidebarItemSlot} />}\n              workspaceUI={this}\n              onSidebarTogglerChange={this.setKeyBindHandler}\n            />\n          ),\n        },\n      ],\n    };\n  }\n\n  private menuItems: MenuItem[] = [\n    {\n      category: 'general',\n      title: 'Open command bar',\n      keyChar: 'mod+k',\n      handler: () => this.commandBarUI?.run('command-bar.open'),\n    },\n    {\n      category: 'general',\n      title: 'Toggle component list',\n      keyChar: 'alt+s',\n      handler: () => this.commandBarUI?.run('sidebar.toggle'),\n    },\n  ];\n\n  static dependencies = [\n    UIAspect,\n    ComponentAspect,\n    SidebarAspect,\n    ComponentTreeAspect,\n    CommandBarAspect,\n    ReactRouterAspect,\n    GraphAspect,\n  ];\n\n  static runtime = UIRuntime;\n\n  static slots = [\n    Slot.withType<RouteProps>(),\n    Slot.withType<RouteProps>(),\n    Slot.withType<ComponentTreeNode>(),\n    Slot.withType<MenuItemSlot>(),\n    Slot.withType<SidebarItemSlot>(),\n    Slot.withType<DrawerWidgetSlot>(),\n    Slot.withType<ComponentFiltersSlot>(),\n  ];\n\n  static async provider(\n    [ui, componentUi, sidebar, componentTree, commandBarUI, reactRouterUI, graphUI]: [\n      UiUI,\n      ComponentUI,\n      SidebarUI,\n      ComponentTreeUI,\n      CommandBarUI,\n      ReactRouterUI,\n      GraphUI\n    ],\n    config,\n    [routeSlot, menuSlot, menuItemSlot, sidebarSlot, sidebarItemSlot, drawerWidgetSlot, drawerComponentsFiltersSlot]: [\n      RouteSlot,\n      RouteSlot,\n      MenuItemSlot,\n      SidebarWidgetSlot,\n      SidebarItemSlot,\n      DrawerWidgetSlot,\n      ComponentFiltersSlot\n    ]\n  ) {\n    componentTree.registerTreeNode(new ComponentTreeWidget());\n    sidebarSlot.register(new ComponentTreeWidget());\n    graphUI.registerComponentWidget(new ComponentTreeWidget().widget);\n\n    const workspaceUI = new WorkspaceUI(\n      routeSlot,\n      componentUi,\n      menuSlot,\n      menuItemSlot,\n      sidebar,\n      sidebarSlot,\n      sidebarItemSlot,\n      drawerWidgetSlot,\n      drawerComponentsFiltersSlot,\n      commandBarUI,\n      reactRouterUI\n    );\n\n    workspaceUI.registerDrawerComponentFilters([DeprecateFilter, EnvsFilter]);\n    workspaceUI.registerDrawerWidgets([\n      <FilterWidget key={'workspace-filter-widget'} />,\n      <TreeToggleWidget key={'workspace-tree-toggle-widget'} />,\n    ]);\n    ui.registerRoot(workspaceUI.uiRoot.bind(workspaceUI));\n    workspaceUI.registerMenuItem(workspaceUI.menuItems);\n\n    workspaceUI.registerSidebarLink(() => (\n      <MenuLinkItem exact href=\"/\" icon=\"comps\">\n        Gallery\n      </MenuLinkItem>\n    ));\n\n    workspaceUI.registerMenuRoutes([\n      {\n        exact: true,\n        path: '/',\n        children: <Menu menuItemSlot={workspaceUI.menuItemSlot} />,\n      },\n      {\n        path: workspaceUI.componentUi.routePath,\n        children: workspaceUI.componentUi.getMenu(WorkspaceAspect.id),\n      },\n    ]);\n\n    workspaceUI.registerRoutes([\n      {\n        path: workspaceUI.componentUi.routePath,\n        children: workspaceUI.componentUi.getComponentUI(WorkspaceAspect.id),\n      },\n    ]);\n\n    return workspaceUI;\n  }\n}\n\nexport default WorkspaceUI;\n\nWorkspaceAspect.addRuntime(WorkspaceUI);\n"]}