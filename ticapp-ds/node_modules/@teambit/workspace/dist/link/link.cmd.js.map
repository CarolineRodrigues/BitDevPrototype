{"version":3,"sources":["link.cmd.ts"],"names":["LinkCommand","constructor","workspace","logger","docsDomain","description","report","ids","opts","startTime","Date","now","linkResults","json","endTime","numOfComponents","legacyLinkResults","length","timeDiff","coreAspectsLinksWithMainAspect","coreAspectsLinks","teambitBitLink","unshift","numOfCoreAspects","title","name","coreLinks","verbose","compsLinks","componentListLinks","rewireRow","legacyCodemodResults","legacyLinkCodemodResults","nestedLinks","nestedDepsInNmLinks","targetLinks","linkToDirResults","footer","console","chalk","cyan","linkOpts","legacyLink","rewire","linkCoreAspects","linkTeambitBit","linkToDir","target","fetchObject","skipFetchingObjects","link"],"mappings":"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","sourcesContent":["import { Command, CommandOptions } from '@teambit/cli';\nimport { LinkResults } from '@teambit/dependency-resolver';\nimport { Logger } from '@teambit/logger';\nimport { timeFormat } from '@teambit/toolbox.time.time-format';\nimport chalk from 'chalk';\nimport { Workspace, WorkspaceLinkOptions } from '../workspace';\nimport { ComponentListLinks } from './component-list-links';\nimport { CoreAspectsLinks } from './core-aspects-links';\nimport { NestedComponentLinksLinks } from './nested-deps-in-nm-links';\nimport { RewireRow } from './rewire-row';\nimport { linkToDir } from './link-to-dir';\n\ntype LinkCommandOpts = {\n  rewire: boolean;\n  verbose: boolean;\n  target: string;\n  skipFetchingObjects?: boolean;\n};\nexport class LinkCommand implements Command {\n  name = 'link [ids...]';\n  alias = '';\n  description: string;\n  shortDescription = 'link components and core aspects';\n  group = 'development';\n  private = false;\n  options = [\n    ['j', 'json', 'return the output as JSON'],\n    ['', 'verbose', 'verbose output'],\n    ['r', 'rewire', 'Replace relative paths with module paths in code (e.g. \"../foo\" => \"@bit/foo\")'],\n    [\n      '',\n      'target <dir>',\n      'EXPERIMENTAL. link to an external directory (similar to npm-link) so other projects could use these components',\n    ],\n    ['', 'skip-fetching-objects', 'skip fetch missing objects from remotes before linking'],\n  ] as CommandOptions;\n\n  constructor(\n    /**\n     * workspace extension.\n     */\n    private workspace: Workspace,\n\n    /**\n     * logger extension.\n     */\n    private logger: Logger,\n\n    private docsDomain: string\n  ) {\n    this.description = `generate symlinks to resolve module paths for imported components.\\nhttps://${this.docsDomain}/workspace/component-links`;\n  }\n\n  async report([ids]: [string[]], opts: LinkCommandOpts) {\n    const startTime = Date.now();\n    const linkResults = await this.json([ids], opts);\n    const endTime = Date.now();\n    const numOfComponents = linkResults.legacyLinkResults?.length;\n    const timeDiff = timeFormat(endTime - startTime);\n    const coreAspectsLinksWithMainAspect = linkResults.coreAspectsLinks || [];\n    if (linkResults.teambitBitLink) {\n      coreAspectsLinksWithMainAspect.unshift(linkResults.teambitBitLink);\n    }\n    const numOfCoreAspects = coreAspectsLinksWithMainAspect.length;\n\n    const title = `Linked ${numOfComponents} components and ${numOfCoreAspects} core aspects to node_modules for workspace: ${this.workspace.name}`;\n    const coreLinks = CoreAspectsLinks({\n      coreAspectsLinks: coreAspectsLinksWithMainAspect,\n      verbose: opts.verbose,\n    });\n    const compsLinks = ComponentListLinks({ componentListLinks: linkResults.legacyLinkResults, verbose: opts.verbose });\n    const rewireRow = RewireRow({ legacyCodemodResults: linkResults.legacyLinkCodemodResults });\n    const nestedLinks = NestedComponentLinksLinks({\n      nestedDepsInNmLinks: linkResults.nestedDepsInNmLinks,\n      verbose: opts.verbose,\n    });\n    const targetLinks = linkToDir(linkResults.linkToDirResults);\n    const footer = `Finished. ${timeDiff}`;\n    return `${title}\\n${coreLinks}\\n${compsLinks}\\n${rewireRow}${nestedLinks}${targetLinks}${footer}`;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  async json([ids]: [string[]], opts: LinkCommandOpts): Promise<LinkResults> {\n    this.logger.console(\n      `Linking components and core aspects to node_modules for workspaces: '${chalk.cyan(this.workspace.name)}'`\n    );\n\n    const linkOpts: WorkspaceLinkOptions = {\n      legacyLink: true,\n      rewire: opts.rewire,\n      linkCoreAspects: true,\n      linkTeambitBit: true,\n      linkToDir: opts.target,\n      fetchObject: !opts.skipFetchingObjects,\n    };\n    const linkResults = await this.workspace.link(linkOpts);\n    return linkResults;\n  }\n}\n"]}